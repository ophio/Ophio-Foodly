"use strict";var app=angular.module("ophioFoodly",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase","ngStorage"]);app.config(["$routeProvider",function(a){a.when("/home",{templateUrl:"views/home.html",controller:"HomeCtrl",authenticationRequired:!0}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/category/:category",{templateUrl:"views/category.html",controller:"CategoryCtrl",authenticationRequired:!0}).otherwise({redirectTo:"/home"})}]),app.service("settings",function(){this.FIREBASE_URL="https://ophiofoodly.firebaseio.com/",this.AUTH_TOKEN_LENGTH=299,this.LOGIN_PROVIDER="google",this.CHECK_EMAIL_SUFFIX=!0,this.REQUIRED_EMAIL_SUFFIX="@ophio.co.in",this.isEmailAllowed=function(a){var b=this.REQUIRED_EMAIL_SUFFIX;return a.match(b+"$")[0]===b}}),app.service("AuthenticationService",["settings","$localStorage","$firebaseSimpleLogin","$location",function(a,b,c,d){this.isLoggedIn=function(){var a=this.getAuthToken();return Boolean(a)},this.getAuthToken=function(){if("undefined"!=typeof b.user){var a=b.user.firebaseAuthToken;if("undefined"!=typeof a)return a}return null},this.getCurrentUser=function(){return this.isLoggedIn?b.user:(alert("Your session has expired, Please login again."),void d.path("/login"))},this.tryLogin=function(){var e=c(new Firebase(a.FIREBASE_URL));e.$login(a.LOGIN_PROVIDER,{rememberMe:!0}).then(function(c){console.log(c),a.isEmailAllowed(c.email)?(b.user=c,d.path("/home")):(alert("Logging in with this email is not allowed"),d.path("/login"))},function(a){alert(a)})}}]),app.run(["$rootScope","$location","AuthenticationService",function(a,b,c){a.$on("$routeChangeStart",function(a,d){d.authenticationRequired&&!c.isLoggedIn()&&b.path("/login")})}]);var app=angular.module("ophioFoodly");app.controller("LoginCtrl",["$scope","settings","AuthenticationService",function(a,b,c){a.login=function(){return c.tryLogin()}}]);var app=angular.module("ophioFoodly");app.controller("HomeCtrl",["$scope","$location",function(a,b){a.show=function(a){b.path(a)}}]);var app=angular.module("ophioFoodly");app.controller("CategoryCtrl",["$scope","settings","AuthenticationService","$filter","$routeParams","$firebase",function(a,b,c,d,e,f){var g=new Firebase(b.FIREBASE_URL),h=g.child("availableItems"),i=g.child("votes"),j=function(){var a=d("date")(new Date,"yyyy-MM-dd"),b=f(i.child(a));return b};a.temp={},a.temp.addingItem=!1,a.temp.newItemName="",a.temp.currentCategory=e.category,a.availableItems=f(h),a.todaysVotes=j(),a.categories=[{href:"healthy",title:"Healthy Bites"},{href:"snacks",title:"Snacks"},{href:"drinks",title:"Drinks"}],a.currentUser=c.getCurrentUser(),a.todaysVotes.$on("loaded",function(){a.$apply()}),a.getVoteCount=function(a){return _.keys(a).length},a.upVoteItem=function(b){var c=a.todaysVotes.$child(b),d=c.$child(a.currentUser.id);d.createdAt=new Date,d.$save()},a.addNewItem=function(){var b={name:a.temp.itemName,category:a.temp.currentCategory,createdBy:a.currentUser.id};a.availableItems.$add(b),a.temp.itemName="",a.temp.addingItem=!1}}]);